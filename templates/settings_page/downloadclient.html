{% extends "settings_page/base.html" %}
{% block head %}
<title>Settings - Download Client</title>
{% include "scripts/alpinejs.html" %}
{% endblock head %}
{% block content %}
<div class="flex flex-col gap-2">
    <h2 class="text-lg">Download Client</h2>

    <label for="downloadclient-base-url">Base URL</label>
    <form class="join w-full" hx-put="{{ base_url }}/settings/downloadclient/base-url"
        hx-disabled-elt="#downloadclient-base-url-button">
        <input id="downloadclient-base-url" name="base_url" type="url" value="{{ downloadclient_base_url }}" class="input join-item w-full"
            minlength="1" required />
        <button id="downloadclient-base-url-button" class="join-item btn">
            {% if downloadclient_base_url %}
            Update
            {% else %}
            Add
            {% endif %}
        </button>
    </form>

    <label for="downloadclient-username" class="pt-2">Username</label>
    <form class="join w-full" hx-put="{{ base_url }}/settings/downloadclient/username"
        hx-disabled-elt="#downloadclient-username-button">
        <input id="downloadclient-username" name="username" value="{{ downloadclient_username }}" class="input join-item w-full" minlength="1" required />
        <button id="downloadclient-username-button" class="join-item btn">
            {% if downloadclient_username %}
            Update
            {% else %}
            Add
            {% endif %}
        </button>
    </form>

    <label for="downloadclient-password" class="pt-2">Password</label>
    <form class="join w-full" hx-put="{{ base_url }}/settings/downloadclient/password"
        hx-disabled-elt="#downloadclient-password-button">
        <input id="downloadclient-password" name="password" type="password" {% if downloadclient_password %}placeholder="●●●●●●●●●●●●●●●●●" {% endif %} class="input join-item w-full" minlength="1" required />
        <button id="downloadclient-password-button" class="join-item btn">
            {% if downloadclient_password %}
            Update
            {% else %}
            Add
            {% endif %}
        </button>
    </form>


    <div class="flex flex-col space-y-4 mt-4">
        <!-- Test Connection Section -->
        <div class="flex items-center gap-3">
            <button
                class="btn btn-primary btn-outline btn-sm gap-2 hover:btn-primary"
                hx-get="{{ base_url }}/settings/downloadclient/test-connection"
                hx-target="#connection-info"
                hx-swap="innerHTML"
                hx-indicator="#test-spinner"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="square" stroke-linejoin="miter" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Test Connection
            </button>

            <!-- Loading Indicator -->
            <div id="test-spinner" class="htmx-indicator flex items-center gap-2">
                <span class="loading loading-spinner loading-sm"></span>
                <span class="text-sm text-base-content/70">Testing...</span>
            </div>
        </div>

        <!-- Connection Result Area -->
        <div id="connection-info" class="min-h-[60px] transition-all duration-300">
        </div>
    </div>
{% endblock content %}
